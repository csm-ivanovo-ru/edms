# Внутренняя переписка

## Виды документов

Будем использовать следующие основные виды внутренних документов для внутренней переписки:

- докладная записка (для целей информирования,
 не подразумевает рассмотрения и исполнения, только ознакомление)
- служебная записка (подразумевает рассмотрение, исполнение)

Кроме того, могут быть созданы подвиды указанных выше видов документов,
имеющие дополнительные реквизиты для использования в специальных процессах
обработки документов.

## Обработка служебных записок

Выделим следующие основные этапы обработки служебных записок:

- подписание автором
- согласование (при необходимости)
- регистрация
- рассмотрение (при отсутствии специального процесса обработки)
- исполнение
- списание в дело

### Подготовка записки

Процесс подготовки записки включает в себя:

- подписание автором (на этом этапе должна быть завершена подготовка)
- согласование (при необходимости)
- регистрация

В целях сокращения количества процессов и повышения usability для работников
создавать дополнительный процесс "Завершить подготовку документа" до подписания
не вижу смысла. Этап подписания следует запускать сразу после создания документа.

В случае отказа от подписания записки автором документ должен быть удалён процессом.

- [x] следует исправить настройки доступности по состоянию и разрешить
 изменять записки в состоянии "На подписании".
 Настройка "Внутренняя переписка - для всех пользователей"
- [x] добавить возможность настройки доступности по состоянию
 для групп видов документов
 Добавлено в расширении ДокументооборотКОРП_АдаптацияНастроекДоступностиПоСостоянию
- [ ] TODO: удалять записки при отказе автора от их подписания
- [ ] TODO: предлагать добавлять согласующих на этапе подписания (завершения подготовки)

### Исполнение записки

Процесс исполнения предусматривает один из трёх процессов:

- рассмотрение адресатом (при отсутствии специального процесса обработки)
- исполнение
- ознакомление

#### Ознакомление с докладными записками

Самый простой случай исполнения записки - ознакомления с докладной запиской.
Этот процесс должен быть запущен для докладных записок после регистрации.
Никаких других процессов исполнения в этом случае не требуется.
Исполнитель для ознакомления - адресат.

Срок ознакомления (он же - срок исполнения?) должен быть указан в документе.
Если он не указан - его стоит заполнить алгоритмом в процессе.
Если же он заполнен, срок ознакомления необходимо устанавливать в соответствии
с указанным в документе.

- [x] реализовать процесс ознакомления для докладных записок.
 Запускать сразу после регистрации
- [x] в процессе ознакомления организовать ветвление и менять важность задачи
 на основании разделяемого дополнительного реквизита документа "Важность".
 Для важных документов устанавливать и более короткий срок ознакомления

#### Обработка служебных записок "по умолчанию"

Процесс рассмотрения следует запускать для служебных записок в том случае,
если служебная записка не имеет специального процесса
исполнения (необходимо условие маршрутизации).
Дальнейшее исполнение - по результатам рассмотрения.

Если же служебная записка имеет специальный процесс исполнения...
Вот тут всё непросто, если действовать правильно.
Если адресат является исполнителем роли, которая должна исполнить
документ в соответствии с выбранным процессом - отправляем на исполнение.
А если нет? Так быть не должно, но всё-таки?

- [x] реализовать процесс рассмотрения служебных записок адресатом.
  Запускать сразу после регистрации.
  В процессе рассмотрения служебных записок предварительно проверять
  состояние документа: если он "На рассмотрении", "На ознакомлении",
  "На исполнении", то от рассмотрения отказываемся. Если нет - тогда
  отправляем на рассмотрение.
  Идея в том, что если существуют специальные процессы исполнения для документа,
  тогда они (специальные процессы) будут запущены и состояние документа
  изменится.
  Проблема лишь в том, что комплексные процессы по шаблонам процессам будут
  созданы практически в одно время и для специальных процессов, и для
  обсуждаемого процесса рассмотрения. Поэтому в шаблоне общего процесса
  рассмотрения "по умолчанию" необходимо реализовать некую "паузу"
  до вычисления условия, в котором мы будем проверять состояние документа.
  Для этих целей изменён регламент исполнения задания "Эскалация задач" -
  каждые пять минут днём.
- [ ] TODO: Если среди исполнителей роли, которая должна исполнить документ, нет
  руководителя подразделения, указанного в карточке документа,
  стоит дополнительно направлять документ на ознакомление руководителю
  подразделения. Срок - по процессу исполнения, важность - по реквизиту "Важность".
  Для этого процесса стоит настроить автоматическую эскалацию:
  завершать при просрочке автоматически, кроме важных.
  Для этих целей:

  - [x] добавить автоподстановку "Руководитель подразделения".
    В нашем случае она должна вернуть полную роль "Руководитель подразделения".
    Но - стоит проверить. Если исполнителей такой полной роли нет,
    тогда стоит явно вернуть руководителя подразделения из структуры
    организации.

- [ ] TODO: Если адресат не является исполнителем роли, которая должна исполнить
  документ в соответствии с запущенным специальным процессом, но является
  руководителем (пусть и не прямым) хотя бы одного из исполнителей роли,
  следует направить дополнительно документ на ознакомление адресату.
  Срок ознакомления - по важности документа вычислим.
- [ ] TODO: Если адресат не является исполнителем роли, которая должна исполнить
  документ в соответствии с запущенным специальным процессом, и не является
  руководителем (пусть и не прямым) хотя бы одного из исполнителей роли,
  то мы имеем дело с ошибкой регистрации.
  Адресат был выбран неверно.
  Поэтому в этом случае предлагаю направлять дополнительно (параллельно с исполнением)
  документ на рассмотрение адресату, но с указанием того, что документ отправлен
  на исполнение.
  По результатам рассмотрения адресат либо дополнительно направит документ на исполнение,
  либо укажет в резолюции, что документ адресован ему ошибочно.
  Поручение "Обработать резолюцию" поступит регистратору, который и допустил
  ошибку при регистрации документа. Он и должен в дальнейшем отслеживать
  корректность указания адресата при регистрации.
  В тексте задачи на рассмотрения уже следует обратить внимание регистратора
  на допущенную ошибку.

#### Специальные процессы исполнения служебных записок

Если возможно, должен быть создан специальный процесс исполнения.
Он должен быть запущен после регистрации.
В этом случае рассмотрение не требуется.

### Списание записки в дело

При регистрации служебной записки автоматически запускается процесс
"Обработка внутреннего документа: списание в дело", при условии
"Не имеет специальную процедуру списания И не списан в дело (вн.)".
Исполнитель выбирается на основе
[автоподстановки "Делопроизводитель подразделения"](../../../Автоподстановки/Делопроизводитель%20подразделения/),
поэтому крайне важно указать в карточке документа именно то подразделение,
которое будет отвечать за документооборот по записке, т.е. в дела которого
записка будет списана после рассмотрения / исполнения.

- [x] реализовано
- [ ] TODO: заменить процесс "Списание в дело (ответственному за документ)"
 на описанный выше (это шаблон поручения)
